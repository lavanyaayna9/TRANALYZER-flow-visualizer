\IfFileExists{t2doc.cls}{
    \documentclass[documentation]{subfiles}
}{
    \errmessage{Error: could not find t2doc.cls}
}

\begin{document}

\trantitle
    {sslDecode}
    {SSL/TLS and OpenVPN}
    {Tranalyzer Development Team}

\section{sslDecode}\label{s:sslDecode}

\subsection{Description}
This plugin analyzes SSL/TLS and OpenVPN traffic.

\subsection{Dependencies}
If {\tt SSL\_ANALYZE\_CERT} is activated, then {\bf libssl} is required.
\begin{table}[!ht]
    \centering
    \begin{tabular}{>{\bf}r>{\tt}l>{\tt}l>{\tt}l}
        \toprule
                                     &                      & {\bf SSL\_ANALYZE\_CERT=1}\\
        \midrule
        Ubuntu:                      & sudo apt-get install & libssl-dev      \\
        Arch:                        & sudo pacman -S       & openssl         \\
        %Gentoo:                      & sudo emerge          & openssl         \\
        openSUSE:                    & sudo zypper install  & libopenssl-devel\\
        Red Hat/Fedora\tablefootnote{If the {\tt dnf} command could not be found, try with {\tt yum} instead}:
                                     & sudo dnf install     & openssl-devel   \\
        macOS\tablefootnote{Brew is a packet manager for macOS that can be found here: \url{https://brew.sh}}:
                                     & brew install         & openssl@1.1     \\
        \bottomrule
    \end{tabular}
\end{table}

\subsection{Configuration Flags}
The following flags can be used to control the output of the plugin:
\begin{longtable}{>{\tt}lcl}
    \toprule
    {\bf Name} & {\bf Default} & {\bf Description}\\
    \midrule\endhead%
    SSL\_ANALYZE\_OVPN         & 0    & Analyze OpenVPN (Experimental)\\
    SSL\_ANALYZE\_QUIC         & 0    & Analyze TLS 1.3 client/server hello in decrypted QUIC initial packets\\
                               &      & Requires the \tranrefpl{quicDecode} plugin with {\tt QUIC\_DECODE\_TLS = 1}\\
    \\
    SSL\_REC\_VER              & 1    & Output the list and number of record versions\\
    SSL\_MAX\_REC\_VER         & 3    & Maximum number of record versions to store\\
    SSL\_HAND\_VER             & 1    & Output the list and number of handshake versions\\
    SSL\_MAX\_HAND\_VER        & 2    & Maximum number of handshake versions to store\\
    SSL\_EXT\_LIST             & 1    & Output the list and number of extensions\\
    SSL\_MAX\_EXT              & 20   & Maximum number of extensions to store\\
    \\
    SSL\_SUPP\_VER             & 1    & Output the list and number of supported versions\\
    SSL\_MAX\_SUPP\_VER        & 4    & Maximum number of supported versions to store\\
    \\
    SSL\_SIG\_ALG              & 1    & Output the list and number of signature hash algorithms\\
    SSL\_MAX\_SIG\_ALG         & 15   & Maximum number of signature hash algorithms to store\\
    \\
    SSL\_EC                    & 1    & Output the list and number of elliptic curves\\
    SSL\_MAX\_EC               & 6    & Maximum number of elliptic curves to store\\
    \\
    SSL\_EC\_FORMATS           & 1    & Output the list and number of elliptic curve formats\\
    SSL\_MAX\_EC\_FORMATS      & 6    & Maximum number of elliptic curve formats to store\\
    \\
    SSL\_ALPN\_LIST            & 1    & Output the list and number of protocols (ALPN)\\
    SSL\_ALPS\_LIST            & 1    & Output the list and number of protocols (ALPS)\\
    SSL\_NPN\_LIST             & 1    & Output the list and number of protocols (NPN)\\
    SSL\_MAX\_PROTO            & 6    & Maximum number of protocols (ALPN/ALPS/NPN) to store\\
    SSL\_PROTO\_LEN            & 16   & Maximum number of characters per protocol (ALPN)\\
    \\
    SSL\_CIPHER\_LIST          & 1    & Output the list and number of supported ciphers\\
    SSL\_MAX\_CIPHER           & 3    & Maximum number of ciphers to store\\
    \\
    SSL\_ANALYZE\_CERT         & 1    & Analyze certificates\\

    \\
    \multicolumn{3}{l}{If {\tt SSL\_ANALYZE\_CERT > 0}, the following flags are available:}\\
    \\

    SSL\_CERT\_SERIAL          & 1    & Print the certificate serial number\\
    SSL\_CERT\_FINGPRINT       & 1    & 0: no certificate fingerprint, 1: SHA1, 2: MD5\\
    SSL\_CERT\_VALIDITY        & 1    & Print certificates validity (Valid from/to, lifetime)\\
    SSL\_CERT\_SIG\_ALG        & 1    & Print the certificate signature algorithm\\
    SSL\_CERT\_PUBKEY\_ALG     & 1    & Print the certificate public key algorithm\\
    SSL\_CERT\_ALG\_NAME\_LONG & 0    & Use short (0) or long (1) names for algorithms\\
    SSL\_CERT\_PUBKEY\_TS      & 1    & Print certificates public key type and size\\
    \\
    SSL\_CERT\_SUBJECT         & 2    & 0: no info about cert subject,\\
                               &      & 1: whole subject as one string,\\
                               &      & 2: selected fields (see below)\\
    \\
    SSL\_CERT\_ISSUER          & 2    & 0: no info about cert issuer,\\
                               &      & 1: whole issuer as one string,\\
                               &      & 2: selected fields (see below)\\
    \\
    SSL\_CERT\_COMMON\_NAME    & 1    & Print the common name of the issuer/subject\\
    SSL\_CERT\_ORGANIZATION    & 1    & Print the organization name of the issuer/subject\\
    SSL\_CERT\_ORG\_UNIT       & 1    & Print the organizational unit of the issuer/subject\\
    SSL\_CERT\_LOCALITY        & 1    & Print the locality name of the issuer/subject\\
    SSL\_CERT\_STATE           & 1    & Print the state/province name of the issuer/subject\\
    SSL\_CERT\_COUNTRY         & 1    & Print the country of the issuer/subject (iso3166)\\
    \\
    SSL\_RM\_CERTDIR           & 1    & Remove {\tt SSL\_CERT\_PATH} before starting\\
    SSL\_SAVE\_CERT            & 0    & Save certificates\\
    SSL\_CERT\_NAME\_FINDEX    & 0    & Prepend the flowIndex to the certificate name\\
    \\
    SSL\_DETECT\_TOR           & 0    & Detect likely Tor connections\\
    SSL\_BLIST                 & 0    & Flag blacklisted certificates\\                    % & SSL\_SAVE\_CERT=1||SSL\_CERT\_FINGPRINT=1\\
    SSL\_BLIST\_LEN            & 41   & Max length for blacklist descriptions\\            % & SSL\_SAVE\_CERT=1||SSL\_CERT\_FINGPRINT=1\\
    \\
    SSL\_JA4                   & 1    & Output JA4/JA4S fingerprints\\
    SSL\_JA4\_O                & 0    & Output JA4/JA4S\_o fingerprints (original order)\\
    SSL\_JA4\_R                & 0    & Output JA4/JA4S\_r fingerprints (raw)\\
    SSL\_JA4\_RO               & 0    & Output JA4/JA4S\_ro fingerprints (raw, original order)\\
    SSL\_JA4\_STR\_LEN         & 254  & Max length for uncompressed JA4 signatures (JA4/JA4S\_r, JA4/JA4S\_ro)\\
    SSL\_JA4\_DLEN             & 64   & Max length for JA4/JA4S descriptions ({\small\tt sslJA4Desc})\\
    \\
    SSL\_JA3                   & 1    & Output JA3 fingerprints (hash and description)\\   % & SSL\_SAVE\_CERT=1||SSL\_CERT\_FINGPRINT=1\\
    SSL\_JA3\_STR              & 0    & Also output JA3 fingerprints before hashing\\      % & SSL\_SAVE\_CERT=1||SSL\_CERT\_FINGPRINT=1\\
    SSL\_JA3\_DLEN             & 64   & Max length for JA3 descriptions\\
    SSL\_JA3\_STR\_LEN         & 1024 & Max length for uncompressed JA3 signatures (ja3\_str)\\
    \bottomrule
\end{longtable}

If {\tt SSL\_SAVE\_CERT==1} then, certificates are saved under {\tt SSL\_CERT\_PATH} (default: {\tt "/tmp/TranCerts/"}) with the extension {\tt SSL\_CERT\_EXT} (default: {\tt ".pem"}) and the SHA1 or MD5 fingerprint as filename.

\subsubsection{Environment Variable Configuration Flags}
The following configuration flags can also be configured with environment variables ({\tt ENVCNTRL>0}):
\begin{itemize}
    \item {\tt SSL\_RM\_CERTDIR}
    \item {\tt SSL\_CERT\_PATH}
    \item {\tt SSL\_CERT\_EXT}
\end{itemize}

\subsection{Flow File Output}
The sslDecode plugin outputs the following columns:
\begin{longtable}{>{\tt}lll>{\tt\small}l}
    \toprule
    {\bf Column} & {\bf Type} & {\bf Description} & {\bf Flags}\\
    \midrule\endhead%
    \nameref{sslStat}                            & H32           & Status                                         & \\
    \nameref{sslProto}                           & H32           & Protocol                                       & \\
    \\
    \nameref{ovpnType}                           & H16           & OpenVPN message types                          & SSL\_ANALYZE\_OVPN=1\\
    ovpnSessionID                                & U64           & OpenVPN session ID                             & SSL\_ANALYZE\_OVPN=1\\
    \\
    \nameref{sslFlags}                           & H8            & SSL flags                                      & \\
    \hyperref[sslVersion]{sslVersion}            & H16           & SSL/TLS Version                                & \\
    sslNumRecVer                                 & U16           & Number of record versions                      & SSL\_REC\_VER=1\\
    \hyperref[sslVersion]{sslRecVer}             & R(H16)        & List of record versions                        & SSL\_REC\_VER=1\\
    sslNumHandVer                                & U16           & Number of handshake versions                   & SSL\_HAND\_VER=1\\
    \hyperref[sslVersion]{sslHandVer}            & R(H16)        & List of handshake versions                     & SSL\_HAND\_VER=1\\
    \nameref{sslVuln}                            & H8            & Vulnerabilities                                & \\
    \nameref{sslAlert}                           & H64           & Alert type                                     & \\
    \nameref{sslCipher}                          & H16           & Preferred (Client)/Negotiated (Server) cipher  & \\
    sslNumExt                                    & U16           & Number of extensions                           & SSL\_EXT\_LIST=1\\
    \nameref{sslExtList}                         & R(H16)        & List of extensions                             & SSL\_EXT\_LIST=1\\
    sslNumSuppVer                                & U16           & Number of supported versions                   & SSL\_SUPP\_VER=1\\
    \hyperref[sslVersion]{sslSuppVer}            & R(H16)        & List of supported versions (client)            & SSL\_SUPP\_VER=1\\
                                                 &               & (Server: negotiated version)                   & \\
    sslNumSigAlg                                 & U16           & Number of signature hash algorithms            & SSL\_SIG\_ALG=1\\
    \nameref{sslSigAlg}                          & R(H16)        & List of signature hash algorithms              & SSL\_SIG\_ALG=1\\
    sslNumECPt                                   & U16           & Number of elliptic curve points                & SSL\_EC=1\\
    sslECPt                                      & R(H16)        & List of elliptic curve points                  & SSL\_EC=1\\
    sslNumECFormats                              & U8            & Number of EC point formats                     & SSL\_EC\_FORMATS=1\\
    sslECFormats                                 & R(H8)         & List of EC point formats                       & SSL\_EC\_FORMATS=1\\
    sslNumALPN                                   & U16           & Number of protocols (ALPN)                     & SSL\_ALPN\_LIST=1\\
    sslALPNList                                  & R(S)          & List of protocols (ALPN)                       & SSL\_ALPN\_LIST=1\\
    sslNumALPS                                   & U16           & Number of protocols (ALPS)                     & SSL\_ALPS\_LIST=1\\
    sslALPSList                                  & R(S)          & List of protocols (ALPS)                       & SSL\_ALPS\_LIST=1\\
    sslNumNPN                                    & U16           & Number of protocols (NPN)                      & SSL\_NPN\_LIST=1\\
    sslNPNList                                   & R(S)          & List of protocols (NPN)                        & SSL\_NPN\_LIST=1\\
    sslNumCipher                                 & U16           & Number of supported ciphers                    & SSL\_CIPHER\_LIST=1\\
    \hyperref[sslCipher]{sslCipherList}          & R(H16)        & List of supported ciphers                      & SSL\_CIPHER\_LIST=1\\
    \hyperref[sslNumRec]{sslNumCC\_}             & U16\_         & Number of change\_cipher records,              & \\
    \qquad\hyperref[sslNumRec]{A\_}              & \qquad U16\_  & \qquad Number of alert records,                & \\
    \qquad\hyperref[sslNumRec]{H\_}              & \qquad U16\_  & \qquad Number of handshake records,            & \\
    \qquad\hyperref[sslNumRec]{AD\_}             & \qquad U64\_  & \qquad Number of application data records,     & \\
    \qquad\hyperref[sslNumRec]{HB}               & \qquad U64    & \qquad Number of heartbeat records             & \\
    sslSessIdLen                                 & U8            & Session ID length                              & \\
    sslGMTTime                                   & R(TS)         & GMT Unix Time                                  & \\
    sslServerName                                & R(S)          & server name                                    & \\

    \\
    \multicolumn{4}{l}{If {\tt SSL\_ANALYZE\_CERT == 1}, the following columns are output:}\\
    \\

    sslCertVersion                               & R(U8)         & Certificate version                            & SSL\_CERT\_FINGPRINT=1\\
    sslCertSerial                                & R(SC)         & Certificate serial number                      & SSL\_CERT\_SERIAL=1\\
    sslCertSha1FP                                & R(SC)         & Certificate SHA1 fingerprint                   & SSL\_CERT\_FINGPRINT=1\\
    sslCertMd5FP                                 & R(SC)         & Certificate MD5 fingerprint                    & SSL\_CERT\_FINGPRINT=2\\
    \hyperref[sslValidity]{sslCNotValidBefore\_} & TS\_          & Certificate validity: not valid before,        & SSL\_CERT\_VALIDITY=1\\
    \qquad\hyperref[sslValidity]{after\_}        & R(\qquad TS\_ & \qquad not valid after,                        & \\
    \qquad\hyperref[sslValidity]{lifetime}       & \qquad U64)   & \qquad lifetime                                & \\
    sslCSigAlg                                   & RS            & Certificate signature algorithm                & SSL\_CERT\_SIG\_ALG=1\\
    sslCKeyAlg                                   & RS            & Certificate public key algorithm               & SSL\_CERT\_PUBKEY\_ALG=1\\
    sslCPKeyType\_                               & SC\_          & Certificate public key type,                   & SSL\_CERT\_PUBKEY\_TS=1\\
    \qquad Size                                  & \qquad U16    & \qquad Certificate public key size (bits)      & \\

    \\
    \multicolumn{4}{l}{If {\tt SSL\_CERT\_SUBJECT > 0}, the following columns are output:}\\
    \\

    sslCSubject                                  & R(S)          & Certificate subject                            & SSL\_CERT\_SUBJECT=1\\
    \\
    sslCSubjectCommonName                        & R(S)          & Certificate subject common name                & SSL\_CERT\_SUBJECT=2\\
    sslCSubjectOrgName                           & R(S)          & Certificate subject organization name          & SSL\_CERT\_SUBJECT=2\\
    sslCSubjectOrgUnit                           & R(S)          & Certificate subject organizational unit name   & SSL\_CERT\_SUBJECT=2\\
    sslCSubjectLocality                          & R(S)          & Certificate subject locality name              & SSL\_CERT\_SUBJECT=2\\
    sslCSubjectState                             & R(S)          & Certificate subject state or province name     & SSL\_CERT\_SUBJECT=2\\
    sslCSubjectCountry                           & R(S)          & Certificate subject country name               & SSL\_CERT\_SUBJECT=2\\

    \\
    \multicolumn{4}{l}{If {\tt SSL\_CERT\_ISSUER > 0}, the following columns are output:}\\
    \\

    sslCIssuer                                   & R(S)          & Certificate issuer                             & SSL\_CERT\_ISSUER=1\\
    \\
    sslCIssuerCommonName                         & R(S)          & Certificate issuer common name                 & SSL\_CERT\_ISSUER=2\\
    sslCIssuerOrgName                            & R(S)          & Certificate issuer organization name           & SSL\_CERT\_ISSUER=2\\
    sslCIssuerOrgUnit                            & R(S)          & Certificate issuer organizational unit name    & SSL\_CERT\_ISSUER=2\\
    sslCIssuerLocality                           & R(S)          & Certificate issuer locality name               & SSL\_CERT\_ISSUER=2\\
    sslCIssuerState                              & R(S)          & Certificate issuer state or province name      & SSL\_CERT\_ISSUER=2\\
    sslCIssuerCountry                            & R(S)          & Certificate issuer country name                & SSL\_CERT\_ISSUER=2\\
    \\
    sslBlistCat                                  & R(S)          & Blacklisted certificate category               & SSL\_BLIST=1\&\&\\
                                                 &               &                                                & (SSL\_SAVE\_CERT=1||\\
                                                 &               &                                                & SSL\_CERT\_FINGPRINT=1)\\
    \\
    sslJA3Hash                                   & R(SC)         & JA3 fingerprint                                & SSL\_JA3=1\\
    sslJA3Desc                                   & R(S)          & JA3 description                                & SSL\_JA3=1\\
    sslJA3Str                                    & R(S)          & JA3 string                                     & SSL\_JA3=1\&\&\\
                                                 &               &                                                & SSL\_JA3\_STR=1\\
    \\
    sslJA4                                       & R(SC)         & JA4/JA4S fingerprint                           & SSL\_JA4=1\\
    sslJA4Desc                                   & R(S)          & JA4/JA4S description                           & SSL\_JA4=1\\
    sslJA4O                                      & R(SC)         & JA4/JA4S\_o fingerprint (original order)       & SSL\_JA4\_O=1\\
    sslJA4R                                      & R(SC)         & JA4/JA4S\_r fingerprint (raw)                  & SSL\_JA4\_R=1\\
    sslJA4RO                                     & R(SC)         & JA4/JA4S\_ro fingerprint (raw, original order) & SSL\_JA4\_RO=1\\
    \\
    sslTorFlow                                   & U8            & Tor flow                                       & SSL\_DETECT\_TOR=1\\
    \bottomrule
\end{longtable}

If {\tt SSL\_CERT\_SUBJECT=2} or {\tt SSL\_CERT\_ISSUER=2}, then the columns displayed are controlled by the following self-explanatory flags:
\begin{itemize}
    \item {\tt SSL\_CERT\_COMMON\_NAME},
    \item {\tt SSL\_CERT\_ORGANIZATION},
    \item {\tt SSL\_CERT\_ORG\_UNIT},
    \item {\tt SSL\_CERT\_LOCALITY},
    \item {\tt SSL\_CERT\_STATE},
    \item {\tt SSL\_CERT\_COUNTRY}.
\end{itemize}

\clearpage

\subsubsection{sslStat}\label{sslStat}
The hex based status variable {\tt sslStat} is defined as follows:
\begin{longtable}{>{\tt}rl}
    \toprule
    {\bf sslStat} & {\bf Description} \\
    \midrule\endhead%
    0x0000 0001 & Message had mismatched version\\
    0x0000 0002 & Record was too long (max 16384)\\
    0x0000 0004 & Record was malformed, eg, invalid value\\
    0x0000 0008 & Certificate had expired\\
    \\
    0x0000 0010 & Connection was closed due to fatal alert\\
    0x0000 0020 & Connection was renegotiated (existed before)\\
    0x0000 0040 & Peer not allowed to send heartbeat requests\\
    0x0000 0080 & Cipher list truncated\ldots increase {\tt SSL\_MAX\_CIPHER}\\
    \\
    0x0000 0100 & Extension list truncated\ldots increase {\tt SSL\_MAX\_EXT}\\
    0x0000 0200 & Protocol (ALPN/NPN/ALPS) list truncated\ldots increase {\tt SSL\_MAX\_PROTO}\\
    0x0000 0400 & Protocol (ALPN/NPN/ALPS) name truncated\ldots increase {\tt SSL\_PROTO\_LEN}\\
    0x0000 0800 & EC or EC formats list truncated\ldots increase {\tt SSL\_MAX\_EC} or {\tt SSL\_MAX\_EC\_FORMATS}\\
    \\
    0x0000 1000 & Certificate is blacklisted\\
    0x0000 2000 & Insecure or weak cipher detected (Null, DES, RC4 (RFC7465), ADH, 40/56 bits)\\
    0x0000 4000 & Weak protocol detected (SSL 2.0, SSL 3.0)\\
    0x0000 8000 & Weak key detected\\
    \\
    0x0001 0000 & Signature hash algorithms list truncated\ldots increase {\tt SSL\_MAX\_SIG\_ALG}\\
    0x0002 0000 & Supported versions list truncated\ldots increase {\tt SSL\_MAX\_SUPP\_VER}\\
    0x0004 0000 & Packet snapped, decoding failed\\
    0x0008 0000 & Failed to compute JA3 fingerprint\ldots increase {\tt SSL\_JA3\_STR\_LEN}\\
    \\
    0x0010 0000 & Failed to compute JA4/JA4S fingerprint\\
    0x0020 0000 & JA4/JA4S\_a successfully computed\\
    0x0040 0000 & JA4/JA4S\_b successfully computed\\
    0x0080 0000 & JA4/JA4S\_c successfully computed\\
    \\
    0x0100 0000 & Insecure cipher (should NEVER be used)\\
    0x0200 0000 & Weak cipher (should not be used)\\
    0x0400 0000 & Secure cipher\\
    0x0800 0000 & Perfect Forward Secrecy (PFS) ciphers\\
    \\
    0x1000 0000 & JA4/JA4S fingerprint truncated\ldots increase {\tt SSL\_JA4\_STR\_LEN}\\
    0x2000 0000 & Record versions list truncated\ldots increase {\tt SSL\_MAX\_REC\_VER}\\
    0x4000 0000 & Handshake versions list truncated\ldots increase {\tt SSL\_MAX\_HAND\_VER}\\
    0x8000 0000 & ---\\
    \bottomrule
\end{longtable}

\subsubsection{sslProto}\label{sslProto}
The hex based protocol variable {\tt sslProto} is defined as follows:
\begin{longtable}{>{\tt}rl}
    \toprule
    {\bf sslProto} & {\bf Description} \\
    \midrule\endhead%
    0x0000 0001 & HTTP/0.9, HTTP/1.0 or HTTP/1.1 (ALPN starts with {\tt http})\\
    0x0000 0002 & HTTP/2 ({\tt h2} or {\tt h2c})\\
    0x0000 0004 & HTTP/3 ({\tt h3} or HTTP/0.9/1.1 over QUIC ({\tt hq})\\
    0x0000 0008 & SPDY/1, SPDY/2 or SPDY/3 (ALPN starts with {\tt spdy})\\
    \\
    0x0000 0010 & IMAP \\
    0x0000 0020 & POP3 \\
    0x0000 0040 & FTP \\
    0x0000 0080 & XMPP jabber \\
    \\
    0x0000 0100 & STUN/TURN \\
    0x0000 0200 & Apple Push Notification Service (APNS)) \\
    0x0000 0400 & WebRTC Media and Data or Confidential WebRTC Media and Data\\
    0x0000 0800 & Constrained Application Protocol (\href{https://tools.ietf.org/html/rfc8323}{CoAP})\\
    \\
    0x0000 1000 & \href{https://tools.ietf.org/html/rfc5804}{ManageSieve} \\
    0x0000 2000 & RTP or RTCP\footnote{Guessed by the presence of the {\tt use-srtp} hello extension}\\
    0x0000 4000 & OpenVPN\footnote{Guessed by being able to decode the protocol}\\
    0x0000 8000 & OASIS Message Queuing Telemetry Transport (MQTT)\\
    \\
    0x0001 0000 & acme-tls/1\\
    0x0002 0000 & DICOM\\
    0x0004 0000 & NNTP (reading) or NNTP (transit)\\
    0x0008 0000 & SIP\\
    \\
    0x0010 0000 & Tabular Data Stream Protocol (TDS)\\
    0x0020 0000 & DNS over Dedicated QUIC Connections (DoQ)\\
    0x0040 0000 & DNS-over-TLS (DoT)\\
    0x0080 0000 & IRC\\
    \\
    0x0100 0000 & SMB\\
    0x0200 0000 & SUNRPC\\
    0x0400 0000 & Network Time Security Key Establishment\\
    0x0800 0000 & ---\\
    \\
    0x1000 0000 & ---\\
    0x2000 0000 & ---\\
    0x4000 0000 & GREASE value\\
    0x8000 0000 & Unknown protocol (ALPN matched none of the above)\\
    \bottomrule
\end{longtable}

\subsubsection{ovpnType}\label{ovpnType}
The {\tt ovpnType} column is to be interpreted as follows:
\begin{longtable}{>{\tt}r>{\tt}l}
    \toprule
    {\bf ovpnType} & {\bf Description} \\
    \midrule\endhead%
    $2^{1}$ (=0x0002) & P\_CONTROL\_HARD\_RESET\_CLIENT\_V1\\
    $2^{2}$ (=0x0004) & P\_CONTROL\_HARD\_RESET\_SERVER\_V1\\
    $2^{3}$ (=0x0008) & P\_CONTROL\_SOFT\_RESET\_V1\\
    \\
    $2^{4}$ (=0x0010) & P\_CONTROL\_V1\\
    $2^{5}$ (=0x0020) & P\_ACK\_V1\\
    $2^{6}$ (=0x0040) & P\_DATA\_V1\\
    $2^{7}$ (=0x0080) & P\_CONTROL\_HARD\_RESET\_CLIENT\_V2\\
    \\
    $2^{8}$ (=0x0100) & P\_CONTROL\_HARD\_RESET\_SERVER\_V2\\
    $2^{9}$ (=0x0200) & P\_DATA\_V2\\
    \bottomrule
\end{longtable}

\subsubsection{sslFlags}\label{sslFlags}
The {\tt sslFlags} is defined as follows:
\begin{longtable}{>{\tt}rl}
    \toprule
    {\bf sslFlags} & {\bf Description}\\
    \midrule\endhead%
    0x01 & request is SSLv2\\
    0x02 & SSLv3 version on `request' layer different than on `record' layer\\
    0x04 & {\tt gmt\_unix\_time} is small (less than 1 year since epoch, probably seconds since boot)\\
    0x08 & {\tt gmt\_unix\_time} is more than 5 years in the future (probably random)\\
    \\
    0x10 & random data (28 bytes) is not random\\
    0x20 & compression (deflate) is enabled\\
    \bottomrule
\end{longtable}

\subsubsection{sslVersion, sslRecVer, sslHandVer and sslSuppVer}\label{sslVersion}
The hex based version variables {\tt sslVersion}, {\tt sslRecVer}, {\tt sslHandVer} and {\tt sslSuppVer} are defined as follows:

\begin{minipage}{.48\textwidth}
    \begin{longtable}{>{\tt}rl}
        \toprule
        {\bf sslVersion} & {\bf Description} \\
        \midrule\endhead%
        0x0200 & SSL 2.0\\
        0x0300 & SSL 3.0\\
        0x0301 & TLS 1.0\\
        0x0302 & TLS 1.1\\
        0x0303 & TLS 1.2\\
        0x0304 & TLS 1.3\\
        0x0a0a & GREASE value\\
        0x1a1a & GREASE value\\
        0x2a2a & GREASE value\\
        0x3a3a & GREASE value\\
        0x4a4a & GREASE value\\
        0x5a5a & GREASE value\\
        0x6a6a & GREASE value\\
        0x7a7a & GREASE value\\
        0x7f0e & TLS 1.3 (draft 14)\\
        0x7f0f & TLS 1.3 (draft 15)\\
        0x7f10 & TLS 1.3 (draft 16)\\
        0x7f11 & TLS 1.3 (draft 17)\\
        0x7f12 & TLS 1.3 (draft 18)\\
        0x7f13 & TLS 1.3 (draft 19)\\
        0x7f14 & TLS 1.3 (draft 20)\\
        \bottomrule
    \end{longtable}
\end{minipage}%
\hfill
\begin{minipage}{.48\textwidth}
    \begin{longtable}{>{\tt}rl}
        \toprule
        {\bf sslVersion} & {\bf Description} \\
        \midrule\endhead%
        0x7f15 & TLS 1.3 (draft 21)\\
        0x7f16 & TLS 1.3 (draft 22)\\
        0x7f17 & TLS 1.3 (draft 23)\\
        0x7f18 & TLS 1.3 (draft 24)\\
        0x7f19 & TLS 1.3 (draft 25)\\
        0x7f1a & TLS 1.3 (draft 26)\\
        0x7f1b & TLS 1.3 (draft 27)\\
        0x7f1c & TLS 1.3 (draft 28)\\
        0x8a8a & GREASE value\\
        0x9a9a & GREASE value\\
        0xaaaa & GREASE value\\
        0xbaba & GREASE value\\
        0xcaca & GREASE value\\
        0xdada & GREASE value\\
        0xeaea & GREASE value\\
        0xfafa & GREASE value\\
        0xfb17 & TLS 1.3 (Facebook draft 23)\\
        0xfb1a & TLS 1.3 (Facebook draft 26)\\
        0xfefc & DTLS 1.3\\
        0xfefd & DTLS 1.2\\
        0xfeff & DTLS 1.0\\
        \bottomrule
    \end{longtable}
\end{minipage}

\subsubsection{sslVuln}\label{sslVuln}
The hex based vulnerability variable {\tt sslVuln} is defined as follows:
\begin{longtable}{>{\tt}rl}
    \toprule
    {\bf sslVuln} & {\bf Description} \\
    \midrule\endhead%
    0x01 & vulnerable to BEAST\\
    0x02 & vulnerable to BREACH\\
    0x04 & vulnerable to CRIME\\
    0x08 & vulnerable to FREAK\\
    \\
    0x10 & vulnerable to POODLE\\
    0x20 & HEARTBLEED attack attempted\\
    0x40 & HEARTBLEED attack successful (Not implemented)\\
    0x80 & ---\\
    \bottomrule
\end{longtable}

\subsubsection{sslAlert}\label{sslAlert}
The hex based alert variable {\tt sslAlert} is defined as follows (\textcolor{red}{red} is fatal):\\
\begin{minipage}{.48\textwidth}
    \small
    \begin{longtable}{>{\tt}rl}
        \toprule
        {\bf sslAlert} & {\bf Description} \\
        \midrule\endhead%
                           0x00000000 00000001  & close notify\\
        \textcolor{red}   {0x00000000 00000002} & \textcolor{red}{unexpected message (fatal)}\\
        \textcolor{red}   {0x00000000 00000004} & \textcolor{red}{bad record MAC (fatal)}\\
                           0x00000000 00000008  & decryption failed\\
        \\
                           0x00000000 00000010  & record overflow\\
        \textcolor{red}   {0x00000000 00000020} & \textcolor{red}{decompression failed (fatal)}\\
        \textcolor{red}   {0x00000000 00000040} & \textcolor{red}{handshake failed (fatal)}\\
                           0x00000000 00000080  & no certificate\\
        \\
                           0x00000000 00000100  & bad certificate\\
                           0x00000000 00000200  & unsupported certificate\\
                           0x00000000 00000400  & certificate revoked\\
                           0x00000000 00000800  & certificate expired\\
        \\
                           0x00000000 00001000  & certificate unknown\\
        \textcolor{red}   {0x00000000 00002000} & \textcolor{red}{illegal parameter (fatal)}\\
        \textcolor{red}   {0x00000000 00004000} & \textcolor{red}{unknown CA (fatal)}\\
        \textcolor{red}   {0x00000000 00008000} & \textcolor{red}{access denied (fatal)}\\
        \\
        \textcolor{red}   {0x00000000 00010000} & \textcolor{red}{decode error (fatal)}\\
                           0x00000000 00020000  & decrypt error\\
        \textcolor{red}   {0x00000000 00040000} & \textcolor{red}{export restriction (fatal)}\\
        \textcolor{red}   {0x00000000 00080000} & \textcolor{red}{protocol version (fatal)}\\
        \\
        \textcolor{red}   {0x00000000 00100000} & \textcolor{red}{insufficient security (fatal)}\\
        \textcolor{red}   {0x00000000 00200000} & \textcolor{red}{internal error (fatal)}\\
                           0x00000000 00400000  & user canceled\\
                           0x00000000 00800000  & no renegotiation\\
        \\
                           0x00000000 01000000  & unsupported extension\\
        \textcolor{red}   {0x00000000 02000000} & \textcolor{red}{inappropriate fallback (fatal)}\\
                           0x00000000 04000000  & certificate unobtainable\\
                           0x00000000 08000000  & unrecognized name\\
        \\
                           0x00000000 10000000  & bad certificate status response\\
                           0x00000000 20000000  & bad certificate hash value\\
        \textcolor{red}   {0x00000000 40000000} & \textcolor{red}{unknown PSK identity (fatal)}\\
        \textcolor{red}   {0x00000000 80000000} & \textcolor{red}{no application protocol (fatal)}\\
        \bottomrule
    \end{longtable}
\end{minipage}%
\hfill
\begin{minipage}{.48\textwidth}
    \small
    \begin{longtable}{>{\tt}rl}
        \toprule
        {\bf sslAlert} & {\bf Description} \\
        \midrule\endhead%
        \textcolor{red}   {0x00000001 00000000} & \textcolor{red}{unknown PSK identity (fatal)}\\
        \textcolor{red}   {0x00000002 00000000} & \textcolor{red}{no application protocol (fatal)}\\
                           0x00000004 00000000  & ---\\
                           0x00000008 00000000  & ---\\
        \\
                           0x00000010 00000000  & ---\\
                           0x00000020 00000000  & ---\\
                           0x00000040 00000000  & ---\\
                           0x00000080 00000000  & ---\\
        \\
                           0x00000100 00000000  & ---\\
                           0x00000200 00000000  & ---\\
                           0x00000400 00000000  & ---\\
                           0x00000800 00000000  & ---\\
        \\
                           0x00001000 00000000  & ---\\
                           0x00002000 00000000  & ---\\
                           0x00004000 00000000  & ---\\
                           0x00008000 00000000  & ---\\
        \\
                           0x00010000 00000000  & ---\\
                           0x00020000 00000000  & ---\\
                           0x00040000 00000000  & ---\\
                           0x00080000 00000000  & ---\\
        \\
                           0x00100000 00000000  & ---\\
                           0x00200000 00000000  & ---\\
                           0x00400000 00000000  & ---\\
                           0x00800000 00000000  & ---\\
        \\
                           0x01000000 00000000  & ---\\
                           0x02000000 00000000  & ---\\
                           0x04000000 00000000  & ---\\
                           0x08000000 00000000  & ---\\
        \\
                           0x10000000 00000000  & ---\\
                           0x20000000 00000000  & ---\\
                           0x40000000 00000000  & ---\\
        \textcolor{red}   {0x80000000 00000000} & \textcolor{red}{Fatal}\\
        \bottomrule
    \end{longtable}
\end{minipage}

\subsubsection{sslCipher}\label{sslCipher}
The {\tt sslCipher} variable represents the preferred cipher for the client and the negotiated cipher for the server. The corresponding name can be found in the {\em src/sslCipher.h} file. All values following the {\tt 0x[0-9a-f]a[0-9a-f]a} pattern are GREASE values.

\subsubsection{sslNumCC\_A\_H\_AD\_HB}\label{sslNumRec}
The number of message variable {\tt sslNumCC\_A\_H\_AD\_HB} decomposed as follows:
\begin{longtable}{>{\tt}rl}
    \toprule
    {\bf sslNumCC\_A\_H\_AD\_HB} & {\bf Description} \\
    \midrule\endhead%
    sslNumCC & number of change cipher records\\
    sslNumA  & number of alerts records\\
    sslNumH  & number of handshake records\\
    sslNumAD & number of application data records\\
    sslNumHB & number of heartbeat records\\
    \bottomrule
\end{longtable}

\subsubsection{sslExtList}\label{sslExtList}
The list of extensions is to be interpreted as follows:

\begin{minipage}{.48\textwidth}
    \begin{longtable}{>{\tt}rl}
        \toprule
        {\bf sslExt} & {\bf Description}\\
        \midrule\endhead%
        0x0000 & Server name\\
        0x0001 & Max fragment length\\
        0x0002 & Client certificate URL\\
        0x0003 & Trusted CA keys\\
        0x0004 & Truncated HMAC\\
        0x0005 & Status request\\
        0x0006 & User mapping\\
        0x0007 & Client authz\\
        0x0008 & Server authz\\
        0x0009 & Cert type\\
        0x000a & Supported groups (elliptic curves)\\
        0x000b & EC point formats\\
        0x000c & SRP\\
        0x000d & Signature hash algorithms\\
        0x000e & Use SRTP\\
        0x000f & Heartbeat\\
        0x0010 & ALPN\\
        0x0011 & Status request v2\\
        0x0012 & Signed certificate timestamp\\
        0x0013 & Client certificate type\\
        0x0014 & Server certificate type\\
        0x0015 & Padding\\
        0x0016 & Encrypt then MAC\\
        0x0017 & Extended master secret\\
        0x0018 & Token binding\\
        0x0019 & Cached info\\
        0x001a & TLS LTS\\
        0x001b & Compress certificate\\
        0x001c & Record size limit\\
        0x001d & Pwd protect\\
        0x001e & Pwd clear\\
        0x001f & Password salt\\
        0x0020 & Ticket pinning\\
        0x0021 & TLS cert with extern PSK\\
        0x0022 & Delegated credential\\
        0x0023 & Session ticket\\
        0x0024 & TLMSP\\
        0x0025 & TLMSP proxying\\
        0x0026 & TLMSP delegate\\
        0x0027 & Supported EKT ciphers\\
        0x0028 & Extended random\\
        0x0029 & Pre-Shared Key (PSK)\\
        0x002a & Early data\\
        \bottomrule
    \end{longtable}
\end{minipage}
\hfill
\begin{minipage}{.48\textwidth}
    \begin{longtable}{>{\tt}rl}
        \toprule
        {\bf sslExt} & {\bf Description}\\
        \midrule\endhead%
        0x002b & Supported versions\\
        0x002c & Cookie\\
        0x002d & PSK key exchange modes\\
        0x002f & Certificate authorities\\
        0x0030 & OID filters\\
        0x0031 & Post handshake auth\\
        0x0032 & Signature algorithms cert\\
        0x0033 & Key Share\\
        0x0034 & Transparency info\\
        0x0035 & Connection ID (deprecated)\\
        0x0036 & Connection ID\\
        0x0037 & External ID hash\\
        0x0038 & External session ID\\
        0x0039 & QUIC transport parameters\\
        0x0040 & Ticket request\\
        0x0041 & DNSSEC chain\\
        0x0042 & Sequence number encryption algo. (DTLS)\\
        0x0043 & Return Routability Check (RRC) for DTLS\\
        0x0a0a & GREASE value\\
        0x1a1a & GREASE value\\
        0x2a2a & GREASE value\\
        0x3374 & NPN\\
        0x3377 & Origin bound cert\\
        0x337c & Encrypted client cert\\
        0x3a3a & GREASE value\\
        0x4469 & Application settings (ALPS)\\
        0x4a4a & GREASE value\\
        0x5a5a & GREASE value\\
        0x6a6a & GREASE value\\
        0x754f & Channel ID old\\
        0x7550 & Channel ID\\
        0x7a7a & GREASE value\\
        0x8a8a & GREASE value\\
        0x9a9a & GREASE value\\
        0xaaaa & GREASE value\\
        0xbaba & GREASE value\\
        0xcaca & GREASE value\\
        0xdada & GREASE value\\
        0xeaea & GREASE value\\
        0xfafa & GREASE value\\
        0xfd00 & Encrypted Client Hello outer extensions\\
        0xfe0d & Encrypted Client Hello\\
        0xff01 & Renegotiation info\\
        \bottomrule
    \end{longtable}
\end{minipage}

\subsubsection{sslSigAlg}\label{sslSigAlg}
The list of signature hash algorithms is to be interpreted as follows:

\begin{minipage}{.48\textwidth}
    \begin{longtable}{>{\tt}rl}
        \toprule
        {\bf sslSigAlg} & {\bf Description}\\
        \midrule\endhead%
        0x0201 & rsa\_pkcs1\_sha1\\
        0x0203 & ecdsa\_sha1\\
        0x0401 & rsa\_pkcs1\_sha256\\
        0x0403 & ecdsa\_secp256r1\_sha256\\
        0x0420 & rsa\_pkcs1\_sha256\_legacy\\
        0x0501 & rsa\_pkcs1\_sha384\\
        0x0503 & ecdsa\_secp384r1\_sha384\\
        0x0520 & rsa\_pkcs1\_sha384\_legacy\\
        0x0601 & rsa\_pkcs1\_sha512\\
        0x0620 & rsa\_pkcs1\_sha512\_legacy\\
        0x0603 & ecdsa\_secp521r1\_sha512\\
        0x0708 & sm2sig\_sm3\\
        0x0709 & gostr34102012\_256a\\
        0x070a & gostr34102012\_256b\\
        0x070b & gostr34102012\_256c\\
        0x070c & gostr34102012\_256d\\
        0x070d & gostr34102012\_512a\\
        0x070e & gostr34102012\_512b\\
        0x070f & gostr34102012\_512c\\
        0x0804 & rsa\_pss\_rsae\_sha256\\
        0x0805 & rsa\_pss\_rsae\_sha384\\
        0x0806 & rsa\_pss\_rsae\_sha512\\
        0x0807 & ed25519\\
        0x0808 & ed448\\
        0x0809 & rsa\_pss\_pss\_sha256\\
        0x080a & rsa\_pss\_pss\_sha384\\
        0x080b & rsa\_pss\_pss\_sha512\\
        0x081a & ecdsa\_brainpoolP256r1tls13\_sha256\\
        0x081b & ecdsa\_brainpoolP384r1tls13\_sha384\\
        0x081c & ecdsa\_brainpoolP512r1tls13\_sha512\\
        0x0a0a & GREASE value\\
        0x1a1a & GREASE value\\
        0x2a2a & GREASE value\\
        0x3a3a & GREASE value\\
        0x4a4a & GREASE value\\
        0x5a5a & GREASE value\\
        0x6a6a & GREASE value\\
        0x7a7a & GREASE value\\
        0x8a8a & GREASE value\\
        0x9a9a & GREASE value\\
        0xaaaa & GREASE value\\
        0xbaba & GREASE value\\
        0xcaca & GREASE value\\
        \bottomrule
    \end{longtable}
\end{minipage}
\hfill
\begin{minipage}{.48\textwidth}
    \begin{longtable}{>{\tt}rl}
        \toprule
        {\bf sslSigAlg} & {\bf Description}\\
        \midrule\endhead%
        0xdada & GREASE value\\
        0xeaea & GREASE value\\
        0xfafa & GREASE value\\
        0xfea0 & dilithium2\\
        0xfea1 & p256\_dilithium2\\
        0xfea2 & rsa3072\_dilithium2\\
        0xfea3 & dilithium3\\
        0xfea4 & p384\_dilithium3\\
        0xfea5 & dilithium5\\
        0xfea6 & p521\_dilithium5\\
        0xfea7 & dilithium2\_aes\\
        0xfea8 & p256\_dilithium2\_aes\\
        0xfea9 & rsa3072\_dilithium2\_aes\\
        0xfeaa & dilithium3\_aes\\
        0xfeab & p384\_dilithium3\_aes\\
        0xfeac & dilithium5\_aes\\
        0xfead & p521\_dilithium5\_aes\\
        0xfe0b & falcon512\\
        0xfe0c & p256\_falcon512\\
        0xfe0d & rsa3072\_falcon512\\
        0xfe0e & falcon1024\\
        0xfe0f & p521\_falcon1024\\
        0xfe96 & picnicl1full\\
        0xfe97 & p256\_picnicl1full\\
        0xfe98 & rsa3072\_picnicl1full\\
        0xfe1b & picnic3l1\\
        0xfe1c & p256\_picnic3l1\\
        0xfe1d & rsa3072\_picnic3l1\\
        0xfe27 & rainbowIclassic\\
        0xfe28 & p256\_rainbowIclassic\\
        0xfe29 & rsa3072\_rainbowIclassic\\
        0xfe3c & rainbowVclassic\\
        0xfe3d & p521\_rainbowVclassic\\
        0xfe42 & sphincsharaka128frobust\\
        0xfe43 & p256\_sphincsharaka128frobust\\
        0xfe44 & rsa3072\_sphincsharaka128frobust\\
        0xfe5e & sphincssha256128frobust\\
        0xfe5f & p256\_sphincssha256128frobust\\
        0xfe60 & rsa3072\_sphincssha256128frobust\\
        0xfe7a & sphincsshake256128frobust\\
        0xfe7b & p256\_sphincsshake256128frobust\\
        0xfe7c & rsa3072\_sphincsshake256128frobust\\
               & \\
        \bottomrule
    \end{longtable}
\end{minipage}

\subsubsection{sslCNotValidBefore\_after\_lifetime}\label{sslValidity}
The {\tt sslCNotValidBefore\_after\_lifetime} indicates the validity period of the certificate, i.e., not valid before / after, and the number of seconds between those two dates.

\subsection{Plugin Report Output}
The following information is reported:
\begin{itemize}
    \item Aggregated {\tt\nameref{sslStat}}
    \item Number of OpenVPN flows ({\tt SSL\_ANALYZE\_OVPN=1})
    \item Number of Tor flows ({\tt SSL\_DETECT\_TOR=1})
    \item Number of SSL 2.0, 3.0
    \item Number of TLS 1.0, 1.1, 1.2 and 1.3
    \item Number of DTLS 1.0 (OpenSSL pre 0.9.8f), 1.0 and 1.2 flows.
    \item Aggregated {\tt\nameref{sslProto}}
    \item Number of certificates saved ({\tt SSL\_SAVE\_CERT=1})
    \item Number of blacklisted certificates ({\tt SSL\_BLIST=1})
    \item Number of JA3 signatures matched ({\tt SSL\_JA3=1})
    \item Number of JA4 signatures matched ({\tt SSL\_JA4=1})
    \item Number of JA4S signatures matched ({\tt SSL\_JA4=1})
\end{itemize}

%\subsection{TODO}
%In order to analyze all certificates, we need to reassemble packets.

\end{document}
