\IfFileExists{t2doc.cls}{
    \documentclass[documentation]{subfiles}
}{
    \errmessage{Error: could not find t2doc.cls}
}

\begin{document}

\trantitle
    {stunDecode}
    {STUN, TURN, ICE and NAT-PMP}
    {Tranalyzer Development Team}

\section{stunDecode}\label{s:stunDecode}
This plugin analyzes the following protocols:
\begin{itemize}
    \item Session Traversal Utilities for Nat (STUN)
    \item Traversal Using Relays around NAT (TURN)
    \item Interactive Connectivity Establishment (ICE)
    \item NAT Port Mapping Protocol (NAT-PMP)
\end{itemize}

\subsection{Configuration Flags}
The following flags can be used to control the output of the plugin:
\begin{longtable}{>{\tt}lcl}
    \toprule
    {\bf Name} & {\bf Default} & {\bf Description} \\
    \midrule\endhead%
    NAT\_PMP & 1 & Analyze NAT-PMP\\
    \bottomrule
\end{longtable}

\subsection{Flow File Output}
The stunDecode plugin outputs the following columns:
\begin{longtable}{>{\tt}lll>{\tt\small}l}
    \toprule
    {\bf Column}                 & {\bf Type}         & {\bf Description} & {\bf Flags}\\
    \midrule\endhead%
    \nameref{natStat}            & H32                & status                                   & \\
    \nameref{natErr}             & H32                & error code                               & \\
    \nameref{natMCReqIndSuccErr} & U16\_U16\_U16\_U16 & number of messages (Req, Ind, Succ, Err) & \\
    natAddr\_Port                & IP4\_U16           & mapped address and port                  & \\
    natXAddr\_Port               & IP4\_U16           & (xor) mapped address and port            & \\
    natPeerAddr\_Port            & IP4\_U16           & peer address and port                    & \\
    natOrigAddr\_Port            & IP4\_U16           & response origin address and port         & \\
    natRelayAddr\_Port           & IP4\_U16           & relayed address and port                 & \\
    natDstAddr\_Port             & IP4\_U16           & destination address and port             & \\
    natOtherAddr\_Port           & IP4\_U16           & other address and port                   & \\
    natLifetime                  & U32                & binding lifetime (seconds)               & \\
    natUser                      & S                  & username                                 & \\
    natPass                      & S                  & password                                 & \\
    natRealm                     & S                  & realm                                    & \\
    natSoftware                  & S                  & software                                 & \\

    \\
    \multicolumn{4}{l}{If {\tt NAT\_PMP=1}, the following columns are displayed:}\\
    \\

    natPMPReqEA\_MU\_MT          & U16\_U16\_U16      & NAT-PMP num.\ of requests                & \\
                                 &                    & (External Address, Map UDP, Map TCP)     & \\
    natPMPRespEA\_MU\_MT         & U16\_U16\_U16      & NAT-PMP num.\ of responses               & \\
                                 &                    & (External Address, Map UDP, Map TCP)     & \\
    natPMPSSSOE                  & U32                & NAT-PMP seconds since start of epoch     & \\
    \bottomrule
\end{longtable}

\subsubsection{natStat}\label{natStat}
The {\tt natStat} column is to be interpreted as follows:%\\
%\begin{minipage}{.48\textwidth}
    \begin{longtable}{>{\tt}rl}
        \toprule
        {\bf natStat} & {\bf Description}\\
        \midrule\endhead%
        $2^{0}$  (=0x0000 000\textcolor{magenta}{1}) & STUN protocol\\
        $2^{1}$  (=0x0000 000\textcolor{magenta}{2}) & TURN protocol\\
        $2^{2}$  (=0x0000 000\textcolor{magenta}{4}) & ICE protocol\\
        $2^{3}$  (=0x0000 000\textcolor{magenta}{8}) & SIP protocol\\
        \\
        $2^{4}$  (=0x0000 00\textcolor{magenta}{1}0) & Microsoft Extension\\
        $2^{5}$  (=0x0000 00\textcolor{magenta}{2}0) & Even Port\\
        $2^{6}$  (=0x0000 00\textcolor{magenta}{4}0) & Reserve next port\\
        $2^{7}$  (=0x0000 00\textcolor{magenta}{8}0) & Don't fragment\\
        \\
        $2^{8}$  (=0x0000 0\textcolor{magenta}{1}00) & Nonce\\
        %$2^{9}$  (=0x0000 0\textcolor{magenta}{2}00) & ---\\
        %$2^{10}$ (=0x0000 0\textcolor{magenta}{4}00) & ---\\
        %$2^{11}$ (=0x0000 0\textcolor{magenta}{8}00) & ---\\
        \\
        %$2^{12}$ (=0x0000 \textcolor{magenta}{1}000) & ---\\
        $2^{13}$ (=0x0000 \textcolor{magenta}{2}000) & Deprecated message attribute\\
        $2^{14}$ (=0x0000 \textcolor{magenta}{4}000) & STUN over non-standard port\\
        $2^{15}$ (=0x0000 \textcolor{magenta}{8}000) & malformed message\\
        \\
%        \bottomrule
%    \end{longtable}
%\end{minipage}
%\hfill
%\begin{minipage}{.48\textwidth}
%    \begin{longtable}{>{\tt}rl}
%        \toprule
%        {\bf natStat} & {\bf Description}\\
%        \midrule\endhead%
        $2^{16}$ (=0x000\textcolor{magenta}{1} 0000) & Port Mapping Protocol (PMP)\\
        %$2^{17}$ (=0x000\textcolor{magenta}{2} 0000) & ---\\
        %$2^{18}$ (=0x000\textcolor{magenta}{4} 0000) & ---\\
        %$2^{19}$ (=0x000\textcolor{magenta}{8} 0000) & ---\\
        \\
        %$2^{20}$ (=0x00\textcolor{magenta}{1}0 0000) & ---\\
        %$2^{21}$ (=0x00\textcolor{magenta}{2}0 0000) & ---\\
        %$2^{22}$ (=0x00\textcolor{magenta}{4}0 0000) & ---\\
        %$2^{23}$ (=0x00\textcolor{magenta}{8}0 0000) & ---\\
        %\\
        %$2^{24}$ (=0x0\textcolor{magenta}{1}00 0000) & ---\\
        %$2^{25}$ (=0x0\textcolor{magenta}{2}00 0000) & ---\\
        %$2^{26}$ (=0x0\textcolor{magenta}{4}00 0000) & ---\\
        %$2^{27}$ (=0x0\textcolor{magenta}{8}00 0000) & ---\\
        %\\
        %$2^{28}$ (=0x\textcolor{magenta}{1}000 0000) & ---\\
        %$2^{29}$ (=0x\textcolor{magenta}{2}000 0000) & ---\\
        %$2^{30}$ (=0x\textcolor{magenta}{4}000 0000) & ---\\
        $2^{31}$ (=0x\textcolor{magenta}{8}000 0000) & Packet snapped, analysis incomplete\\
        \bottomrule
    \end{longtable}
%\end{minipage}

\subsubsection{natErr}\label{natErr}
The hex based error variable {\tt natErr} is defined as follows (STUN):
\begin{longtable}{>{\tt}rl}
    \toprule
    {\bf natErr} & {\bf Description} \\
    \midrule\endhead%
    $2^{0}$  (=0x0000000\textcolor{magenta}{1}) & Try alt\\
    $2^{1}$  (=0x0000000\textcolor{magenta}{2}) & Bad request\\
    $2^{2}$  (=0x0000000\textcolor{magenta}{4}) & Unauthorized\\
    $2^{3}$  (=0x0000000\textcolor{magenta}{8}) & Forbidden\\
    \\
    $2^{4}$  (=0x000000\textcolor{magenta}{1}0) & Unknown attribute\\
    $2^{5}$  (=0x000000\textcolor{magenta}{2}0) & Allocation mismatch\\
    $2^{6}$  (=0x000000\textcolor{magenta}{4}0) & Stale nonce\\
    $2^{7}$  (=0x000000\textcolor{magenta}{8}0) & Address family not supported\\
    \\
    $2^{8}$  (=0x00000\textcolor{magenta}{1}00) & Wrong credentials\\
    $2^{9}$  (=0x00000\textcolor{magenta}{2}00) & Unsupported transport protocol\\
    $2^{10}$ (=0x00000\textcolor{magenta}{4}00) & Peer address family mismatch\\
    $2^{11}$ (=0x00000\textcolor{magenta}{8}00) & Connection already exists\\
    \\
    $2^{12}$ (=0x0000\textcolor{magenta}{1}000) & Connection timeout or failure\\
    $2^{13}$ (=0x0000\textcolor{magenta}{2}000) & Allocation quota reached\\
    $2^{14}$ (=0x0000\textcolor{magenta}{4}000) & Role conflict\\
    $2^{15}$ (=0x0000\textcolor{magenta}{8}000) & Server error\\
    \\
    $2^{16}$ (=0x000\textcolor{magenta}{1}0000) & Insufficient capacity\\
    \\
    $2^{31}$ (=0x\textcolor{magenta}{8}0000000) & Unhandled error\\
    \bottomrule
\end{longtable}

The hex based error variable {\tt natErr} is defined as follows (NAT-PMP):
\begin{longtable}{>{\tt}rl}
    \toprule
    {\bf natErr} & {\bf Description} \\
    \midrule\endhead%
    $2^{1}$ (=0x0000000\textcolor{magenta}{2}) & Unsupported version\\
    $2^{2}$ (=0x0000000\textcolor{magenta}{4}) & Not authorized/refused\\
    $2^{3}$ (=0x0000000\textcolor{magenta}{8}) & Network failure\\
    \\
    $2^{4}$ (=0x000000\textcolor{magenta}{1}0) & Out of resources\\
    $2^{5}$ (=0x000000\textcolor{magenta}{2}0) & Unsupported opcode\\
    \bottomrule
\end{longtable}

\subsubsection{natMCReq\_Ind\_Succ\_Err}\label{natMCReqIndSuccErr}
The number of messages variable {\tt natMCReq\_Ind\_Succ\_Err} decomposed as follows:
\begin{longtable}{>{\tt}rl}
    \toprule
    {\bf natMCReq\_Ind\_Succ\_Err} & {\bf Description} \\
    \midrule\endhead%
    natMCReq  & number of requests\\
    natMCInd  & number of indications\\
    natMCSucc & number of success response\\
    natMCErr  & number of error response\\
    \bottomrule
\end{longtable}

\subsection{Plugin Report Output}
The following information is reported:
\begin{itemize}
    \item Aggregated {\tt\nameref{natStat}}
    \item Aggregated {\tt\nameref{natErr}}
    \item Number of NAT-PMP packets
    \item Number of STUN packets
\end{itemize}

\subsection{TODO}
Port Control Protocol (PCP)

\end{document}
