-- Top applications by number of bytes

SELECT
    SPLIT_PART("nDPIclass", '.', 1) AS appl,
    SUM("l7BytesSnt") + SUM("l7BytesRcvd") AS cnt
FROM
    flow
WHERE
    ("flowStat"::BIGINT & 1) = 0::BIGINT
    AND "timeFirst" >= to_timestamp(:time_from)
    AND "timeLast" <= to_timestamp(:time_to)

GROUP BY appl
ORDER BY cnt :sort_order

LIMIT :n
