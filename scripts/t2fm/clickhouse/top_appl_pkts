-- Top applications by number of packets

SELECT
    toValidUTF8(splitByChar('.', "nDPIclass")[1]) AS appl,
    SUM("pktsSnt") + SUM("pktsRcvd") AS cnt
FROM
    flow
WHERE
    bitTest("flowStat", 0) = 0
    AND "timeFirst" >= {time_from:DateTime64(6)}
    AND "timeLast" <= {time_to:DateTime64(6)}

GROUP BY appl
ORDER BY multiply(cnt, {sort_order:Int8})

LIMIT {n:UInt64}
