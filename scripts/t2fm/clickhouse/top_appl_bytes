-- Top applications by number of bytes

SELECT
    toValidUTF8(splitByChar('.', "nDPIclass")[1]) AS appl,
    SUM("l7BytesSnt") + SUM("l7BytesRcvd") AS cnt
FROM
    flow
WHERE
    bitTest("flowStat", 0) = 0
    AND "timeFirst" >= {time_from:DateTime64(6)}
    AND "timeLast" <= {time_to:DateTime64(6)}

GROUP BY appl
ORDER BY multiply(cnt, {sort_order:Int8})

LIMIT {n:UInt64}
